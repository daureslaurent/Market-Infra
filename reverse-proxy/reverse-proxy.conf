
# Common proxy headers (can also be a snippet)
map $http_upgrade $connection_upgrade {
    default upgrade;
    ''      close;
}

server {
    listen 80;
    server_name _;  # catch-all; adjust if you later add a real domain

    # Standard headers
    proxy_http_version 1.1;
    proxy_set_header Host              $host;
    proxy_set_header X-Real-IP         $remote_addr;
    proxy_set_header X-Forwarded-For   $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header Upgrade           $http_upgrade;
    proxy_set_header Connection        $connection_upgrade;

    # Uploads/timeouts (tune as needed)
    # client_max_body_size 50m;
    # proxy_connect_timeout 5s;
    # proxy_read_timeout    60s;
    # proxy_send_timeout    60s;

    # Backend (path-based) â€” note trailing slash on proxy_pass to keep subpath semantics
    location /api/ {
        proxy_pass http://host.docker.internal:8080/;
        # If you need basic rate limiting:
        # limit_req zone=api_rate burst=20 nodelay;
    }

    # Frontend (root)
    location / {
        proxy_pass http://host.docker.internal:8081;
        # If you serve SPAs, you may want:
        # try_files $uri $uri/ /index.html;
    }
}
